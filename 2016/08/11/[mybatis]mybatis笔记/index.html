<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="JavaEE,Java,mybatis," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="JDBC回顾JDBC连接数据库分为六步1. 加载驱动 2. 创建连接 3. 获取statement对象 4. 执行sql语句 5. 处理结果集 6. 关闭资源  存在的问题及解决方案1、加载驱动问题： 　　● 每次执行都加载驱动 　　● 驱动名称，硬编码到java代码中，如果需要修改驱动，需要修改java文件         —— 解决方案：将驱动名称放入到外部的配置文件 2、数据库的连接信息，硬">
<meta name="keywords" content="JavaEE,Java,mybatis">
<meta property="og:type" content="article">
<meta property="og:title" content="mybatis笔记">
<meta property="og:url" content="http://qianmingxs.com/2016/08/11/[mybatis]mybatis笔记/index.html">
<meta property="og:site_name" content="Mr.Qian&#39;s Home">
<meta property="og:description" content="JDBC回顾JDBC连接数据库分为六步1. 加载驱动 2. 创建连接 3. 获取statement对象 4. 执行sql语句 5. 处理结果集 6. 关闭资源  存在的问题及解决方案1、加载驱动问题： 　　● 每次执行都加载驱动 　　● 驱动名称，硬编码到java代码中，如果需要修改驱动，需要修改java文件         —— 解决方案：将驱动名称放入到外部的配置文件 2、数据库的连接信息，硬">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://i.imgur.com/I20xxTm.png">
<meta property="og:image" content="http://i.imgur.com/rupfMQb.png">
<meta property="og:image" content="http://i.imgur.com/pHNaWys.png">
<meta property="og:image" content="http://img.blog.csdn.net/20160802171100530">
<meta property="og:image" content="http://i.imgur.com/X0igqa5.png">
<meta property="og:image" content="http://i.imgur.com/9XiuQMK.png">
<meta property="og:image" content="http://i.imgur.com/hURwgDx.png">
<meta property="og:image" content="http://i.imgur.com/lGbkLOR.png">
<meta property="og:image" content="http://i.imgur.com/Ch9AR6z.png">
<meta property="og:image" content="http://i.imgur.com/dokD9Lz.png">
<meta property="og:image" content="http://i.imgur.com/1CDRzor.png">
<meta property="og:image" content="http://i.imgur.com/vUHzBKf.png">
<meta property="og:image" content="http://i.imgur.com/StHBgCi.png">
<meta property="og:image" content="http://i.imgur.com/k8rtmcd.png">
<meta property="og:image" content="http://i.imgur.com/q6iBImX.png">
<meta property="og:image" content="http://i.imgur.com/So9Ptdk.png">
<meta property="og:image" content="http://i.imgur.com/GKLEVn7.png">
<meta property="og:image" content="http://i.imgur.com/PLq7JS8.png">
<meta property="og:image" content="http://i.imgur.com/CTiAuKz.png">
<meta property="og:image" content="http://i.imgur.com/DlB41sl.png">
<meta property="og:image" content="http://i.imgur.com/T8Ghcku.png">
<meta property="og:image" content="http://i.imgur.com/MYBT4po.png">
<meta property="og:image" content="http://i.imgur.com/6fIzsFk.png">
<meta property="og:image" content="http://i.imgur.com/Vzy1hda.png">
<meta property="og:image" content="http://i.imgur.com/8URkb5u.png">
<meta property="og:image" content="http://i.imgur.com/i6Rwlo0.png">
<meta property="og:image" content="http://i.imgur.com/dh6mcwe.png">
<meta property="og:image" content="http://i.imgur.com/bdcNIic.png">
<meta property="og:image" content="http://i.imgur.com/T5wdiqe.png">
<meta property="og:image" content="http://i.imgur.com/h9QffWS.png">
<meta property="og:image" content="http://i.imgur.com/EbzMZer.png">
<meta property="og:image" content="http://i.imgur.com/BQQ7iX7.png">
<meta property="og:image" content="http://i.imgur.com/ymQQ6nN.png">
<meta property="og:image" content="http://i.imgur.com/o1OxJMa.png">
<meta property="og:image" content="http://i.imgur.com/2m1FkUi.png">
<meta property="og:image" content="http://i.imgur.com/IrbSbCH.png">
<meta property="og:image" content="http://i.imgur.com/TxLA7bj.png">
<meta property="og:image" content="http://i.imgur.com/CBcMlvg.png">
<meta property="og:image" content="http://i.imgur.com/Ny0NUin.png">
<meta property="og:image" content="http://i.imgur.com/e489uAs.png">
<meta property="og:image" content="http://i.imgur.com/K1YSI2j.png">
<meta property="og:image" content="http://i.imgur.com/RW4Q6F3.png">
<meta property="og:image" content="http://i.imgur.com/UcpX9OF.png">
<meta property="og:image" content="http://i.imgur.com/Ny0NUin.png">
<meta property="og:image" content="http://i.imgur.com/uvS6OXb.png">
<meta property="og:image" content="http://i.imgur.com/rnuPgvZ.png">
<meta property="og:image" content="http://i.imgur.com/R9JdYy3.png">
<meta property="og:image" content="http://i.imgur.com/qP9KCdP.png">
<meta property="og:updated_time" content="2017-07-19T07:22:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mybatis笔记">
<meta name="twitter:description" content="JDBC回顾JDBC连接数据库分为六步1. 加载驱动 2. 创建连接 3. 获取statement对象 4. 执行sql语句 5. 处理结果集 6. 关闭资源  存在的问题及解决方案1、加载驱动问题： 　　● 每次执行都加载驱动 　　● 驱动名称，硬编码到java代码中，如果需要修改驱动，需要修改java文件         —— 解决方案：将驱动名称放入到外部的配置文件 2、数据库的连接信息，硬">
<meta name="twitter:image" content="http://i.imgur.com/I20xxTm.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'PERBMK758D',
      apiKey: 'bb735480ebfad21cf22f48a7a44c066a',
      indexName: 'Hexo',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://qianmingxs.com/2016/08/11/[mybatis]mybatis笔记/"/>





  <title>mybatis笔记 | Mr.Qian's Home</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Mr.Qian's Home</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://qianmingxs.com/2016/08/11/[mybatis]mybatis笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Qian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.Qian's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">mybatis笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-11T00:00:00+08:00">
                2016-08-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mybatis/" itemprop="url" rel="index">
                    <span itemprop="name">mybatis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="JDBC回顾"><a href="#JDBC回顾" class="headerlink" title="JDBC回顾"></a>JDBC回顾</h2><h3 id="JDBC连接数据库分为六步"><a href="#JDBC连接数据库分为六步" class="headerlink" title="JDBC连接数据库分为六步"></a>JDBC连接数据库分为六步</h3><pre><code>1. 加载驱动
2. 创建连接
3. 获取statement对象
4. 执行sql语句
5. 处理结果集
6. 关闭资源
</code></pre><p><img src="http://i.imgur.com/I20xxTm.png" alt=""></p>
<h3 id="存在的问题及解决方案"><a href="#存在的问题及解决方案" class="headerlink" title="存在的问题及解决方案"></a>存在的问题及解决方案</h3><pre><code>1、加载驱动问题：
　　● 每次执行都加载驱动
　　● 驱动名称，硬编码到java代码中，如果需要修改驱动，需要修改java文件
        —— 解决方案：将驱动名称放入到外部的配置文件
2、数据库的连接信息，硬编码到java代码中
        —— 解决方案：外部配置文件
3、sql语句设置参数的问题： 参数下标硬编码了，需要人为的去判断参数的位置
4、遍历结果集：需要人工的判断字段名，以及个位置参数类型，不方便
        —— 是否可以将结果集直接映射到一个pojo对象中
5、频繁的创建连接，关闭连接，导致资源浪费，影响性能
        —— 解决：连接池。
</code></pre><h2 id="mybatis介绍★★"><a href="#mybatis介绍★★" class="headerlink" title="mybatis介绍★★"></a>mybatis介绍★★</h2><p><img src="http://i.imgur.com/rupfMQb.png" alt="xxxx"></p>
<ul>
<li>mybatis的前身是ibatis，改名后将版本升级为3.X</li>
<li>Mybatis是类似Hiberate的 <strong><em>ORM框架</em></strong>，位于<strong><em>持久层</em></strong></li>
<li>Mybatis是直接<strong><em>基于JDBC做了简单的封装</em></strong>，性能角度来看JDBC &gt; mybatis &gt; Hiberate</li>
</ul>
<h2 id="mybatis整体架构"><a href="#mybatis整体架构" class="headerlink" title="mybatis整体架构"></a>mybatis整体架构</h2><p><img src="http://i.imgur.com/pHNaWys.png" alt="xxxx"></p>
<ul>
<li>mybatis-config.xml全局配置文件，包括数据库的连接参数、全局配置项</li>
<li>mapper.xml有多个，配置sql语句</li>
<li>SqlSessionFactory创建SqlSession</li>
<li>SqlSession执行crud操作</li>
<li>executor底层的执行器</li>
<li>Mappered Statement为一个个的sql语句</li>
</ul>
<h2 id="mybatis快速入门-参考官方文档-★★★★★"><a href="#mybatis快速入门-参考官方文档-★★★★★" class="headerlink" title="mybatis快速入门(参考官方文档)★★★★★"></a>mybatis快速入门(参考官方文档)★★★★★</h2><h3 id="github"><a href="#github" class="headerlink" title="github"></a>github</h3><p><a href="https://github.com/rhapsody1290/MybatisStudy" target="_blank" rel="external">https://github.com/rhapsody1290/MybatisStudy</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li>想要使用 MyBatis 只需将 mybatis-x.x.x.jar 文件置于 classpath 中</li>
<li>如果使用 Maven 构建项目，则需将下面的 dependency 置于 pom.xml 中  </li>
</ul>
<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
  &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
  &lt;version&gt;3.2.8&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h3 id="从-XML-中构建-SqlSessionFactory"><a href="#从-XML-中构建-SqlSessionFactory" class="headerlink" title="从 XML 中构建 SqlSessionFactory"></a>从 XML 中构建 SqlSessionFactory</h3><ul>
<li>每个基于 MyBatis 的应用都是以一个 SqlSessionFactory 的实例为中心的</li>
<li><strong>SqlSessionFactory</strong> 的实例可以通过 <strong>SqlSessionFactoryBuilder</strong> 获得</li>
<li>SqlSessionFactoryBuilder 可以从 <strong>XML 配置文件</strong>或<strong>一个预先定制的 Configuration 的实例</strong>构建出 SqlSessionFactory 的实例（直接从Java程序中创建配置）</li>
</ul>
<p><strong><em>从XML配置文件创建SqlSessionFactory实例</em></strong></p>
<p>从 XML 文件中构建 SqlSessionFactory 的实例非常简单，建议使用类路径下的资源文件进行配置。但是也可以使用任意的 InputStream 实例，包括字符串形式或 URL 形式的文件路径来配置。MyBatis 包含一个叫 Resources 的工具类，它包含一些静态方法，可使从 classpath 或其他位置加载资源文件更容易。</p>
<pre><code>String resource = &quot;mybatis-config.xml&quot;;//指定配置文件的路径
InputStream inputStream = Resources.getResourceAsStream(resource);//默认会从classes目录下寻找配置文件
SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
</code></pre><p><strong><em>mybatis-config.xml——XML配置文件核心设置</em></strong></p>
<p>XML 配置文件（configuration XML）中包含了对 MyBatis 系统的<strong><em>核心设置</em></strong> ，包含<strong><em>获取数据库连接实例的数据源</em></strong>（DataSource）和<strong><em>决定事务范围和控制方式的事务管理器</em></strong>（TransactionManager）。XML 配置文件的详细内容后面再探讨，这里先给出一个简单的示例：</p>
<pre><code>&lt;!-- mybatis-config.xml --&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
  &lt;environments default=&quot;development&quot;&gt;
    &lt;environment id=&quot;development&quot;&gt;
      &lt;transactionManager type=&quot;JDBC&quot;/&gt;
      &lt;dataSource type=&quot;POOLED&quot;&gt;
        &lt;property name=&quot;driver&quot; value=&quot;${driver}&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;${url}&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;${username}&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;${password}&quot;/&gt;
      &lt;/dataSource&gt;
    &lt;/environment&gt;
  &lt;/environments&gt;
  &lt;mappers&gt;
    &lt;mapper resource=&quot;mapper.xml&quot;/&gt;
  &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre><font color="red">注意：上述配置文件采用了Property文件注入的方式，这里为了方便，我们可以直接写死连接数据库的参数</font>

<p><img src="http://img.blog.csdn.net/20160802171100530" alt=""></p>
<p>当然，XML 配置文件中还有很多可以配置的，上面的示例指出的则是<strong><em>最关键的部分</em></strong>。要注意 XML 头部的声明，需要用来验证 XML 文档正确性。</p>
<ul>
<li>environment 元素体中包含了事务管理和连接池的环境配置</li>
<li>mappers 元素是包含一组 mapper 映射器（这些 mapper的 XML 文件包含了 SQL 代码和映射定义信息）</li>
</ul>
<h3 id="mapper-xml——映射文件"><a href="#mapper-xml——映射文件" class="headerlink" title="mapper.xml——映射文件"></a>mapper.xml——映射文件</h3><p>Mapper.xml映射文件中定义了操作数据库的sql，每个sql是一个statement，映射文件是mybatis的核心</p>
<pre><code>&lt;!-- mapper.xml --&gt;    
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;!--namespace：名字空间，唯一标识，不需要特别的起名称，只要保证所有的mapper中唯一即可--&gt;
&lt;mapper namespace=&quot;cn.apeius.User&quot;&gt;
    &lt;!--sql语句映射，也称作mapperedStatement
        resultType：结果集对应的java类型，需要书写类的全路径
        #{id}：相当于？，表示参数的占位--&gt;
    &lt;select id=&quot;selectUser&quot; resultType=&quot;User&quot;&gt;
        select * from tb_user where id = #{id}
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre><h3 id="从-SqlSessionFactory-中获取-SqlSession"><a href="#从-SqlSessionFactory-中获取-SqlSession" class="headerlink" title="从 SqlSessionFactory 中获取 SqlSession"></a>从 SqlSessionFactory 中获取 SqlSession</h3><p>SqlSession 完全包含了面向数据库执行 SQL 命令所需的所有方法。你可以通过 SqlSession 实例来直接执行已映射的 SQL 语句</p>
<pre><code>//获取sqlsession
SqlSession session = sqlSessionFactory.openSession();
try {
    //sqlSession.selectOne(&quot;sql的id&quot;,&quot;sql中需要的参数&quot;)
    User user = (User) session.selectOne(&quot;cn.apeius.User.selectUser&quot;, 1);
    System.out.println(user);
} finally {
    //关闭session
    session.close();
}
</code></pre><h3 id="可能的错误"><a href="#可能的错误" class="headerlink" title="可能的错误"></a>可能的错误</h3><p><img src="http://i.imgur.com/X0igqa5.png" alt=""></p>
<p>问题原因：mybatis没有引入 mapper ，需要在 mybatis-config.xml 中使用mapper引入外部的mapper.xml</p>
<h3 id="mybatis使用步骤总结"><a href="#mybatis使用步骤总结" class="headerlink" title="mybatis使用步骤总结"></a>mybatis使用步骤总结</h3><p><img src="http://i.imgur.com/9XiuQMK.png" alt=""></p>
<p><strong><em>java代码</em></strong><br><img src="http://i.imgur.com/hURwgDx.png" alt=""></p>
<h2 id="添加日志支持"><a href="#添加日志支持" class="headerlink" title="添加日志支持"></a>添加日志支持</h2><h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
    &lt;version&gt;1.6.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h3 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h3><p><strong><em>log4j.properties</em></strong></p>
<pre><code>log4j.rootLogger=DEBUG,A1
log4j.logger.org.mybatis=DEBUG
log4j.appender.A1=org.apache.log4j.ConsoleAppender
log4j.appender.A1.layout=org.apache.log4j.PatternLayout
log4j.appender.A1.layout.ConversionPattern=%-d{yyyy-MM-dd HH:mm:ss,SSS} [%t] [%c]-[%p] %m%n
</code></pre><h2 id="完整的CRUD操作-未使用动态代理类-★★★★★"><a href="#完整的CRUD操作-未使用动态代理类-★★★★★" class="headerlink" title="完整的CRUD操作(未使用动态代理类)★★★★★"></a>完整的CRUD操作(未使用动态代理类)★★★★★</h2><h3 id="创建UserDao接口"><a href="#创建UserDao接口" class="headerlink" title="创建UserDao接口"></a>创建UserDao接口</h3><pre><code>public interface UserDao {
    /**
     * 根据id查询用户信息
     * @param id
     * @return
     */
    public User queryUserById(Long id);
    /**
     * 查询所有用户
     * @return
     */
    public List&lt;User&gt; queryAllUser();
    /**
     * 添加用户信息
     * @param user
     */
    public void addUser(User user);
    /**
     * 修改用户信息
     * @param user
     */
    public void updateUser(User user);
    /**
     * 根据id删除用户信息
     * @param id
     */
    public void deleteUserById(Long id);
}
</code></pre><h3 id="创建UserDao的实现类"><a href="#创建UserDao的实现类" class="headerlink" title="创建UserDao的实现类"></a>创建UserDao的实现类</h3><pre><code>public class UserDaoImpl implements UserDao {
    private SqlSession sqlSession;
    public UserDaoImpl(SqlSession sqlSession){
        this.sqlSession = sqlSession;
    }
    public User queryUserById(Long id) {
        return sqlSession.selectOne(&quot;user.queryUserById&quot;, id);
    }

    public List&lt;User&gt; queryAllUser() {
        return sqlSession.selectList(&quot;user.queryAllUser&quot;);
    }

    public void addUser(User user) {
        sqlSession.insert(&quot;user.addUser&quot;, user);
    }

    public void updateUser(User user) {
        sqlSession.update(&quot;user.updateUser&quot;, user);
    }

    public void deleteUserById(Long id) {
        sqlSession.delete(&quot;user.deleteUserById&quot;, id);
    }
}
</code></pre><h3 id="编写User对应的Mapper-xml"><a href="#编写User对应的Mapper-xml" class="headerlink" title="编写User对应的Mapper.xml"></a>编写User对应的Mapper.xml</h3><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;!--
    1、namespace：名字空间，唯一标识，不需要特别的起名称，只要保证所有的mapper中唯一即可
    2、但为了与Mapper接口进行映射，一般为Mapper接口的完全限定名
    --&gt;
&lt;mapper namespace=&quot;cn.apeius.mybatis.mapper.UserMapper&quot;&gt;
    &lt;select id=&quot;queryUserById&quot; resultType=&quot;cn.apeius.mybatis.domain.User&quot;&gt;
        select * from tb_user where id = #{id}
    &lt;/select&gt;

    &lt;!-- resultType为结果集映射的java的类型 --&gt;
    &lt;select id=&quot;queryAllUser&quot; resultType=&quot;cn.apeius.mybatis.domain.User&quot;&gt;
        select * from tb_user
    &lt;/select&gt;

    &lt;!-- #{}中的值为domain类中的属性名 --&gt;
    &lt;insert id=&quot;addUser&quot;&gt;
        INSERT INTO tb_user VALUES (NULL,#{user_name},#{password},#{name},#{age},#{sex},#{birthday},NOW(),NOW())
    &lt;/insert&gt;

    &lt;update id=&quot;updateUser&quot;&gt;
        UPDATE tb_user SET user_name = #{user_name},password = #{password},name = #{name}, age = #{age}, sex = #{sex}, birthday = #{birthday}, updated = NOW() WHERE id=#{id}
    &lt;/update&gt;

    &lt;delete id=&quot;deleteUserById&quot;&gt;
        delete from tb_user where id = #{id}
    &lt;/delete&gt;
&lt;/mapper&gt;
</code></pre><h3 id="全部配置文件mybatis-config-xml加入UserMapper-xml"><a href="#全部配置文件mybatis-config-xml加入UserMapper-xml" class="headerlink" title="全部配置文件mybatis-config.xml加入UserMapper.xml"></a>全部配置文件mybatis-config.xml加入UserMapper.xml</h3><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot;/&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/mybatis&quot;/&gt;
                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;
    &lt;mappers&gt;
        &lt;mapper resource=&quot;UserMapper.xml&quot;/&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre><h3 id="编写测试用例JUNIT★★★★★★★"><a href="#编写测试用例JUNIT★★★★★★★" class="headerlink" title="编写测试用例JUNIT★★★★★★★"></a>编写测试用例JUNIT★★★★★★★</h3><ul>
<li>在UserDao接口中按快捷键Ctrl + Shift + T，快速创建UserDaoTest测试类</li>
<li>add/update/delete需要commit</li>
</ul>
<pre><code>public class UserDaoTest {
    UserDao userDao;
    SqlSession sqlSession;

    //初始操作        
    @Before
    public void setUp() throws Exception {
        String resource = &quot;mybatis-config.xml&quot;;
        InputStream is = Resources.getResourceAsStream(resource);
        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(is);
        sqlSession = sqlSessionFactory.openSession();
        this.userDao = new UserDaoImpl(sqlSession);
    }

    @After
    public void tearDown() throws Exception{
        sqlSession.close();
    }

    @Test
    public void testQueryUserById() throws Exception {
        User user = userDao.queryUserById(1l);
        System.out.println(user);
    }

    @Test
    public void testQueryAllUser() throws Exception {
        List&lt;User&gt; users = userDao.queryAllUser();
        for(User user : users){
            System.out.println(user);
        }
    }

    @Test
    public void testAddUser() throws Exception {
        User user = new User();
        user.setName(&quot;xxx&quot;);
        user.setAge(18);
        user.setSex(1);
        user.setPassword(&quot;123456&quot;);
        user.setUser_name(&quot;xxxx&quot;);
        user.setBirthday(new Date());
        userDao.addUser(user);
        //需要事务进行提交
        sqlSession.commit();
    }

    @Test
    public void testUpdateUser() throws Exception {
        //先查询再更新
        User user = userDao.queryUserById(15l);
        user.setUser_name(&quot;二舅&quot;);
        userDao.updateUser(user);
        sqlSession.commit();
    }

    @Test
    public void testDeleteUserById() throws Exception {
        userDao.deleteUserById(17l);
        sqlSession.commit();
    }
}
</code></pre><h3 id="解决数据库字段名和实体类属性名不一致的问题"><a href="#解决数据库字段名和实体类属性名不一致的问题" class="headerlink" title="解决数据库字段名和实体类属性名不一致的问题"></a>解决数据库字段名和实体类属性名不一致的问题</h3><p>查询数据的时候，查不到userName的信息，原因：数据库的字段名是<strong><em>user_name</em></strong>，POJO中的属性名字是<strong><em>username</em></strong>，两端不一致，造成mybatis无法填充对应的字段信息</p>
<ul>
<li>解决方案1：在sql语句中使用别名</li>
</ul>
<p><img src="http://i.imgur.com/lGbkLOR.png" alt=""></p>
<p><img src="http://i.imgur.com/Ch9AR6z.png" alt=""></p>
<ul>
<li>解决方案2： 参考后面的resultMap –mapper具体的配置的时候</li>
<li>解决方案3：参考驼峰匹配 — mybatis-config.xml 的时候</li>
</ul>
<h2 id="动态代理mapper实现类★★★★★★★"><a href="#动态代理mapper实现类★★★★★★★" class="headerlink" title="动态代理mapper实现类★★★★★★★"></a>动态代理mapper实现类★★★★★★★</h2><h3 id="思考CURD的dao中的问题"><a href="#思考CURD的dao中的问题" class="headerlink" title="思考CURD的dao中的问题"></a>思考CURD的dao中的问题</h3><p><img src="http://i.imgur.com/dokD9Lz.png" alt=""></p>
<p>1、上述开发过程为：接口-&gt;实现类-&gt;mapper.xml<br>2、可以发现在实现类中，使用mybatis的方式非常类似<br>　　●  查询 —— selectOne/selectList<br>　　●  查询 —— insert<br>　　●  修改 —— update<br>　　●  删除 —— delete<br>3、sql statement 硬编码到java代码中（举例，函数参数user.queryUserById与mapper.xml中id=”queryUserById对应”）</p>
<p><strong>思考：能否只写接口，不书写实现类，只编写Mapper.xml即可</strong></p>
<p>答：因为在dao（mapper）的实现类中对sqlsession的使用方式很类似，mybatis提供了接口的动态代理</p>
<h3 id="名称空间"><a href="#名称空间" class="headerlink" title="名称空间"></a>名称空间</h3><ul>
<li>mapper.xml 根标签的 namespace 属性 称为名称空间。namespace的定义本身是没有限制的，只要不重复就行</li>
<li>如果希望使用mybatis通过的动态代理的接口，就需要namespace中的值，和需要对应的Mapper(dao)接口的全路径一致</li>
</ul>
<p><img src="http://i.imgur.com/1CDRzor.png" alt=""></p>
<h3 id="通过sqlSession-getMapper-Class"><a href="#通过sqlSession-getMapper-Class" class="headerlink" title="通过sqlSession.getMapper(Class)"></a>通过sqlSession.getMapper(Class)</h3><ul>
<li><p>在mybatis中，dao层的命名规则，以后都修改成*mapper<br><img src="http://i.imgur.com/vUHzBKf.png" alt=""></p>
</li>
<li><p>要求mapper中的statement,sql中的id 和方法中的名字一模一样才可以去调用<br><img src="http://i.imgur.com/StHBgCi.png" alt=""></p>
</li>
</ul>
<h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><h4 id="定义接口"><a href="#定义接口" class="headerlink" title="定义接口"></a>定义接口</h4><pre><code>package cn.apeius.mybatis.mapper;

public interface UserMapper {
    /**
     * 根据id查询用户信息
     * @param id
     * @return
     */
    public User queryUserById(Long id);
}
</code></pre><h4 id="编写mapper-xml文件"><a href="#编写mapper-xml文件" class="headerlink" title="编写mapper.xml文件"></a>编写mapper.xml文件</h4><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;!--namespace：名字空间，唯一标识，不需要特别的起名称，只要保证所有的mapper中唯一即可--&gt;
&lt;mapper namespace=&quot;cn.apeius.mybatis.mapper.UserMapper&quot;&gt;
    &lt;select id=&quot;queryUserById&quot; resultType=&quot;cn.apeius.mybatis.domain.User&quot;&gt;
        select * from tb_user where id = #{id}
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre><h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><pre><code>public class UserMapperTest {
    UserMapper userMapper;
    SqlSession sqlSession;

    @Before
    public void setUp() throws Exception {
        String resource = &quot;mybatis-config.xml&quot;;
        InputStream is = Resources.getResourceAsStream(resource);
        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(is);
        this.sqlSession = sqlSessionFactory.openSession();
        //this.userMapper = new UserDaoImpl(sqlSession);
        this.userMapper = sqlSession.getMapper(UserMapper.class);
    }

    @Test
    public void testQueryUserById() throws Exception {
        User user = userMapper.queryUserById(1l);
        System.out.println(user);
    }
}
</code></pre><h3 id="使用动态代理总结★★★★★★★★★"><a href="#使用动态代理总结★★★★★★★★★" class="headerlink" title="使用动态代理总结★★★★★★★★★"></a>使用动态代理总结★★★★★★★★★</h3><p><img src="http://i.imgur.com/k8rtmcd.png" alt=""></p>
<ul>
<li><p>在名字空间”cn.apeius.mybatis.mapper.UserMapper”定义了一个名为”queryUserById”的映射语句，这样它就允许使用指定的完全限定名”cn.apeius.mybatis.mapper.UserMapper.queryUserById”来调用映射语句</p>
<pre><code>User user = sqlSession.selectOne(&quot;cn.apeius.mybatis.mapper.UserMapper.queryUserById&quot;,1L);
System.out.println(user);
</code></pre></li>
<li><p>这和使用完全限定名调用Java对象的方法是相似的，这样命名可以直接映射到命名空间同名的Mapper类，并将select语句中的名字、参数和返回类型映射成Mapper类的方法，这样可以调用对应Mapper接口的方法</p>
<pre><code>UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
User user = userMapper.queryUserById(1L);
System.out.println(user);
</code></pre></li>
<li><p><strong><em>综上所述：namespace与Mapper接口映射，sql语句与mapper接口中的方法映射</em></strong></p>
</li>
<li><strong><em>一张表对应一个Doamin对象，一个Mapper接口（DAO），一个mapper.xml</em></strong>。例如user表对应User.java、UserMapper.java、UserMapper.xml</li>
</ul>
<h2 id="mybatis-config-xml-配置"><a href="#mybatis-config-xml-配置" class="headerlink" title="mybatis-config.xml 配置"></a>mybatis-config.xml 配置</h2><p>子标签出现的顺序不能改变</p>
<p><img src="http://i.imgur.com/q6iBImX.png" alt=""></p>
<h3 id="properties-读取外部的资源文件"><a href="#properties-读取外部的资源文件" class="headerlink" title="properties(读取外部的资源文件)"></a>properties(读取外部的资源文件)</h3><p><img src="http://i.imgur.com/So9Ptdk.png" alt=""></p>
<p><strong><em>编写jdbc.properties文件</em></strong></p>
<pre><code>driver=com.mysql.jdbc.Driver
url=jdbc:mysql://localhost:3306/mybatis
username=root
password=root
</code></pre><p><strong><em>mybatis-config.xml属性值注入</em></strong></p>
<pre><code>&lt;environments default=&quot;development&quot;&gt;
    &lt;environment id=&quot;development&quot;&gt;
        &lt;transactionManager type=&quot;JDBC&quot;/&gt;
        &lt;dataSource type=&quot;POOLED&quot;&gt;
            &lt;property name=&quot;driver&quot; value=&quot;${driver}&quot;/&gt;
            &lt;property name=&quot;url&quot; value=&quot;${url}&quot;/&gt;
            &lt;property name=&quot;username&quot; value=&quot;${username}&quot;/&gt;
            &lt;property name=&quot;password&quot; value=&quot;${password}&quot;/&gt;
        &lt;/dataSource&gt;
    &lt;/environment&gt;
&lt;/environments&gt;
</code></pre><h3 id="settings（设置）"><a href="#settings（设置）" class="headerlink" title="settings（设置）"></a>settings（设置）</h3><p><strong><em>mapUnderscoreToCamelCase用法：</em></strong></p>
<ul>
<li>开启驼峰匹配：从经典数据库的命名规则，到经典java命名规则的映射</li>
<li>经典数据库的命名规则： </li>
<li></li>
<li></li>
<li>个单词之间使用下划线分割，例如：user_name</li>
<li>java经典命名规则：驼峰样式，多个单词，后续的单词首字母大写 例如：userName</li>
<li>开启驼峰匹配：相当于去掉数据库名字中的下划线，然后在与java中的属性名进行对应</li>
</ul>
<p><img src="http://i.imgur.com/GKLEVn7.png" alt=""></p>
<h3 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a>typeAliases</h3><p>类型别名是为 Java 类型命名的一个短的名字。它只和 XML 配置有关，存在的意义仅在于用来减少类完全限定名的冗余</p>
<p><strong><em>typeAliases的使用1</em></strong></p>
<ul>
<li>使用这个配置，”User”可以用在任何使用”cn.apeius.mybatis.domain.User”的地方</li>
<li><strong><em>大小写不敏感</em></strong></li>
<li>缺点：每个一个类都去书写别名，麻烦</li>
</ul>
<p><img src="http://i.imgur.com/PLq7JS8.png" alt=""></p>
<p><strong><em>typeAliases的使用2——扫描包的方式</em></strong></p>
<p>每一个在包 cn.apeius.mybatis.domain 中的 Java Bean，在没有注解的情况下，会使用 Bean 的<strong><em>首字母小写的非限定类名</em></strong> 来作为它的别名。比如<br>cn.apeius.mybatis.domain.User 的别名为 User，且<strong><em>大小写不敏感</em></strong></p>
<p><img src="http://i.imgur.com/CTiAuKz.png" alt=""></p>
<p>若有注解，则别名为其注解值。</p>
<pre><code>@Alias(&quot;xxx&quot;)
public class User {
    ...
}
</code></pre><h3 id="plugins（插件，又名拦截器）"><a href="#plugins（插件，又名拦截器）" class="headerlink" title="plugins（插件，又名拦截器）"></a>plugins（插件，又名拦截器）</h3><p>MyBatis 允许你在已映射语句执行过程中的某一点进行拦截调用。默认情况下，MyBatis 允许使用插件来拦截的方法调用包括：</p>
<ul>
<li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li>
<li>ParameterHandler (getParameterObject, setParameters)</li>
<li>ResultSetHandler (handleResultSets, handleOutputParameters)</li>
<li>StatementHandler (prepare, parameterize, batch, update, query)</li>
</ul>
<p>图：利用拦截器进行分页<br><img src="http://i.imgur.com/DlB41sl.png" alt=""></p>
<h3 id="environments（环境）"><a href="#environments（环境）" class="headerlink" title="environments（环境）"></a>environments（环境）</h3><h4 id="为什么要适应多种环境"><a href="#为什么要适应多种环境" class="headerlink" title="为什么要适应多种环境"></a>为什么要适应多种环境</h4><p>MyBatis 可以配置成适应多种环境，这种机制有助于将 SQL 映射应用于多种数据库之中，现实情况下有多种理由需要这么做</p>
<ul>
<li>开发环境：开发人员日常开发的时候使用的环境</li>
<li>测试环境：测试人员测试的时候使用环境</li>
<li>预发布环境：几乎和线上环境一模一样，在上线之前在进行一次测试</li>
<li>生成环境：线上环境。 正式的java程序运行的环境</li>
</ul>
<p>不过要记住：尽管可以配置多个环境，<strong><em>每个 SqlSessionFactory 实例只能选择其一</em></strong></p>
<p>所以，如果你想连接两个数据库，就需要创建两个 SqlSessionFactory 实例，每个数据库对应一个。而如果是三个数据库，就需要三个实例，依此类推，记起来很简单：</p>
<ul>
<li><strong><em>每个数据库对应一个 SqlSessionFactory 实例</em></strong></li>
</ul>
<h4 id="指定创建哪种环境"><a href="#指定创建哪种环境" class="headerlink" title="指定创建哪种环境"></a>指定创建哪种环境</h4><p><strong><em>配置多个环境</em></strong></p>
<pre>
&lt;environments <font color="red"> default="development"</font>>
    &lt;environment <font color="blue">id="development"</font>>
        &lt;transactionManager type="JDBC"/>
        &lt;dataSource type="POOLED">
            &lt;property name="driver" value="${driver}"/>
            &lt;property name="url" value="${url}"/>
            &lt;property name="username" value="${username}"/>
            &lt;property name="password" value="${password}"/>
        &lt;/dataSource>
    &lt;/environment>
    &lt;environment <font color="blue">id="online"</font>>
        &lt;transactionManager type="JDBC"/>
        &lt;dataSource type="POOLED">
            &lt;property name="driver" value="${driver}"/>
            &lt;property name="url" value="${url}"/>
            &lt;property name="username" value="${username}"/>
            &lt;property name="password" value="${password}"/>
        &lt;/dataSource>
    &lt;/environment>
&lt;/environments>
</pre>

<p><strong><em>代码指定创建那种环境</em></strong></p>
<pre><code>SqlSessionFactory factory = sqlSessionFactoryBuilder.build(reader, environment);
</code></pre><h3 id="mappers映射器"><a href="#mappers映射器" class="headerlink" title="mappers映射器"></a>mappers映射器</h3><p>mappers映射器将 mapper.xml 文件配置到 mybatis 的环境中</p>
<h4 id="相对于类路径的资源引用"><a href="#相对于类路径的资源引用" class="headerlink" title="相对于类路径的资源引用"></a>相对于类路径的资源引用</h4><pre>
&lt;!-- Using classpath relative resources -->
&lt;mappers>
    &lt;mapper resource="UserMapper.xml"/>
&lt;/mappers>
</pre>

<h4 id="使用mapper接口路径"><a href="#使用mapper接口路径" class="headerlink" title="使用mapper接口路径"></a>使用mapper接口路径</h4><ul>
<li>这里所谓的 <strong><em>mapper接口路径</em></strong>，实际上就是 <strong><em>dao的接口路径</em></strong></li>
<li>在mybatis中，<strong><em>通常把dao的包叫做mapper类名，也叫做mapper</em></strong></li>
<li><p>使用 class 方式去加载的时候，要求</p>
<ul>
<li>要求 mapper.xml 文件的名字和 mapper 接口的名字一致</li>
<li>要求 mapper.xml 文件和 mapper 接口类在一个目录</li>
</ul>
</li>
</ul>
<p><img src="http://i.imgur.com/T8Ghcku.png" alt=""></p>
<pre><code>&lt;mapper class=&apos;cn.itcast.mybatis.mapper.UserMapper&apos;/&gt;
</code></pre><p><strong>问题:</strong><br>1、mapper.xml 和 java文件没有分离,明天和 spring 整合之后解决<br>2、需要一个一个的去加载 mapper</p>
<h4 id="使用mapper接口扫描包-常用"><a href="#使用mapper接口扫描包-常用" class="headerlink" title="使用mapper接口扫描包(常用)"></a>使用mapper接口扫描包(常用)</h4><p>扫描指定包下的所有接口，要求mapper.xml和接口在<strong><em>同一个包下</em></strong>，并且<strong><em>名字相同</em></strong></p>
<pre>
&lt;!-- Register all interfaces in a package as mappers -->
&lt;mappers>
    &lt;package name="cn.itcast.mybatis.mapper"/>
&lt;/mappers>
</pre>


<font color="red"><strong><em>缺点:</em></strong></font>

<p>1、如果包的路径有很多？ 明天spring整合的时候解决<br>2、mapper.xml和mapper.java没有分离</p>
<h2 id="Mapper-xml"><a href="#Mapper-xml" class="headerlink" title="Mapper.xml"></a>Mapper.xml</h2><p><img src="http://i.imgur.com/MYBT4po.png" alt=""></p>
<h3 id="CURD操作"><a href="#CURD操作" class="headerlink" title="CURD操作"></a>CURD操作</h3><h4 id="select——书写select语句"><a href="#select——书写select语句" class="headerlink" title="select——书写select语句"></a>select——书写select语句</h4><p><img src="http://i.imgur.com/6fIzsFk.png" alt=""></p>
<ul>
<li>id属性（必须）：当前名称空间下的statement的<strong><em>唯一标识</em></strong>；要求id和mapper接口中的方法的<strong><em>名字一致</em></strong></li>
<li>resultType：将结果集映射为java的对象类型，和 resultMap 二选一（必须）</li>
<li><strong><em>parameterType：传入参数类型。可以省略</em></strong></li>
</ul>
<h4 id="insert——书写insert语句"><a href="#insert——书写insert语句" class="headerlink" title="insert——书写insert语句"></a>insert——书写insert语句</h4><p><img src="http://i.imgur.com/Vzy1hda.png" alt=""></p>
<ul>
<li>id属性：必须的，当前名称空间下的statement的唯一标识(必须属性)</li>
<li>parameterType：传入的参数类型，可以省略</li>
<li>标签内部：具体的sql语句</li>
<li>使用#{} 去替换一个变量</li>
<li>如果需要数据库影响的行数，可以<strong><em>直接在接口上定义返回值Integer</em></strong> 即可</li>
</ul>
<h4 id="获取自增的id的值"><a href="#获取自增的id的值" class="headerlink" title="获取自增的id的值"></a>获取自增的id的值</h4><p>插入数据后获得自增长的id号</p>
<p><img src="http://i.imgur.com/8URkb5u.png" alt=""></p>
<ul>
<li>useGenerateKeys：true</li>
<li>keyColumn:主键列的名字</li>
<li>keyProperty：实体类对应的属性</li>
</ul>
<p>测试</p>
<p><img src="http://i.imgur.com/i6Rwlo0.png" alt=""></p>
<h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><p><img src="http://i.imgur.com/dh6mcwe.png" alt=""></p>
<ul>
<li>id属性：当前名称空间下的statement的唯一标识(必须属性)</li>
<li>parameterType：传入的参数类型，可以省略</li>
<li>标签内部：具体的sql语句</li>
<li>使用#{} 去替换一个变量</li>
</ul>
<h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h4><p><img src="http://i.imgur.com/bdcNIic.png" alt=""></p>
<ul>
<li>id属性：当前名称空间下的statement的唯一标识(必须属性)</li>
<li>parameterType：传入的参数类型，可以省略</li>
<li>标签内部：具体的sql语句</li>
<li>使用#{} 去替换一个变量</li>
</ul>
<h3 id="的用法及传入多个参数"><a href="#的用法及传入多个参数" class="headerlink" title="#{}的用法及传入多个参数"></a>#{}的用法及传入多个参数</h3><ul>
<li><code>#{}</code> 存在mapper.xml中的sql语句部分，标识该位置可以接受参数信息，<strong><em>相当于?占位符</em></strong></li>
<li>传入的参数和参数名无关，问题：如果有多个参数该怎么办？</li>
</ul>
<p><img src="http://i.imgur.com/T5wdiqe.png" alt=""></p>
<p>方法一：使用0，1……自然数取出对应的数据，0表示第一个参数</p>
<pre><code>select * from tb_user where user_name = #{0} and password = #{1}
</code></pre><p>方法二：使用param1，param2……param1表示第一个参数</p>
<pre><code>select * from tb_user where user_name = #{param1} and password = #{param2}
</code></pre><p><strong><em>方法三（常用）：在方法的定义上使用@param为传入的参数定义一个名字</em></strong></p>
<ul>
<li>在UserMapper接口中声明函数login，使用@param为每个参数定义一个名字</li>
</ul>
<pre><code>public User login(@Param(&quot;username&quot;) String username, @Param(&quot;password&quot;) String password);
</code></pre><ul>
<li>sql语句在#{}中填入定义的名字</li>
</ul>
<pre><code>select * from tb_user where user_name = #{username} and password = #{password}
</code></pre><ul>
<li>测试</li>
</ul>
<pre><code>@Test
public void testLogin(){
    User user = userMapper.login(&quot;zhangsan&quot;,&quot;123456&quot;);
    System.out.println(user);
}
</code></pre><h3 id="的用法及传入多个参数-1"><a href="#的用法及传入多个参数-1" class="headerlink" title="${}的用法及传入多个参数"></a>${}的用法及传入多个参数</h3><p>${}的用法：仍然是接受传递的参数，但是${}是sql语句的拼接</p>
<p><strong><em>需求</em></strong></p>
<p>查询表中的信息，有时候从历史表中去查询数据，有时候需要去新的表去查询数据，希望使用1个方法来完成操作</p>
<ul>
<li><p>方法一：$在取值时，使用value表示传入的参数值，不建议写</p>
<ul>
<li>mapper接口<pre><code>public List&lt;User&gt; queryUserByTableName(String tableName);
</code></pre></li>
<li>mapper.xml<pre><code>select * from ${value}
</code></pre></li>
<li>测试<pre><code>@Test
public void testQueryUsersByTableName(){
    List&lt;User&gt; users = userMapper.queryUserByTableName(&quot;tb_user&quot;);
    for(User u : users){
        System.out.println(u);
    }
}
</code></pre></li>
</ul>
</li>
</ul>
<ul>
<li><p>方法二（常用）：$在取值时，可以在mapper接口的参数之前使用@Param主键为当前参数指定一个名字</p>
<ul>
<li>mapper接口<pre><code>public List&lt;User&gt; queryUserByTableName(@Param(&quot;tableName&quot;) String tableName);
</code></pre></li>
<li>mapper.xml<pre><code>select * from ${tableName}
</code></pre></li>
<li>测试<pre><code>@Test
public void testQueryUsersByTableName(){
    List&lt;User&gt; users = userMapper.queryUserByTableName(&quot;tb_user&quot;);
    for(User u : users){
        System.out.println(u);
    }
}
</code></pre></li>
</ul>
</li>
</ul>
<h3 id="面试题：-与-的区别"><a href="#面试题：-与-的区别" class="headerlink" title="面试题：#{}与${}的区别"></a>面试题：#{}与${}的区别</h3><p><img src="http://i.imgur.com/h9QffWS.png" alt=""></p>
<h3 id="resultMap与resultType用法★★★★★★★★"><a href="#resultMap与resultType用法★★★★★★★★" class="headerlink" title="resultMap与resultType用法★★★★★★★★"></a>resultMap与resultType用法★★★★★★★★</h3><h4 id="从SQL查询结果到领域模型实体"><a href="#从SQL查询结果到领域模型实体" class="headerlink" title="从SQL查询结果到领域模型实体　"></a>从SQL查询结果到领域模型实体　</h4><p><strong><em>从SQL查询结果集到JavaBean或POJO实体的过程：</em></strong></p>
<ol>
<li>通过JDBC查询得到ResultSet对象</li>
<li>遍历ResultSet对象并将每行数据暂存到HashMap实例中，以结果集的字段名或字段别名为键，以字段值为值</li>
<li>根据ResultMap标签的type属性<strong><em>通过反射实例化领域模型</em></strong></li>
<li>根据ResultMap标签的type属性和id、result等标签信息将HashMap中的键值对，填充到领域模型实例中并返回</li>
</ol>
<h4 id="resultType"><a href="#resultType" class="headerlink" title="resultType"></a>resultType</h4><ul>
<li>在MyBatis进行查询映射的时候，其实查询出来的每一个属性都是放在一个对应的Map里面的，其中键是属性名，值则是其对应的值</li>
<li>当提供的返回类型属性是resultType的时候，MyBatis会将Map里面的键值对取出赋给resultType所指定的对象对应的属性</li>
</ul>
<h4 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h4><p>返回类型直接是一个ResultMap主要用在进行复杂联合查询上</p>
<p><strong><em>简单 resultMap 配置</em></strong></p>
<pre><code>&lt;resultMap id=&quot;BlogResult&quot; type=&quot;com.liulanghan.Blog&quot; &gt;    
    &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;    
    &lt;result column=&quot;title&quot; property=&quot;title&quot;/&gt;    
    &lt;result column=&quot;content&quot; property=&quot;content&quot;/&gt;    
    &lt;result column=&quot;owner&quot; property=&quot;owner&quot;/&gt;    
&lt;/resultMap&gt;   

&lt;select id=&quot;selectBlog&quot; parameterType=&quot;int&quot; resultMap=&quot;BlogResult&quot;&gt;    
      select * from t_blog where id = #{id}    
&lt;/select&gt;  
</code></pre><ul>
<li>结果集的列比resultMap多会报错么？ —— 不会,只映射resultMap中有的列</li>
<li>结果集的列比resultMap少会报错么？ —— 不会,只映射结果集中有的列</li>
</ul>
<p><strong><em>高级结果映射</em></strong><br>见高级查询</p>
<h2 id="Mybatis学习路线总结★★★★★★★★★★"><a href="#Mybatis学习路线总结★★★★★★★★★★" class="headerlink" title="Mybatis学习路线总结★★★★★★★★★★"></a>Mybatis学习路线总结★★★★★★★★★★</h2><p><img src="http://i.imgur.com/EbzMZer.png" alt=""></p>
<h2 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h2><p>在mybatis中，一级缓存默认是开启的，并且无法关闭</p>
<p><img src="http://i.imgur.com/BQQ7iX7.png" alt=""></p>
<p><strong><em>一级缓存满足条件：</em></strong></p>
<ol>
<li>同一个session中</li>
<li>相同的SQL和参数</li>
</ol>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>1、测试代码</p>
<p><img src="http://i.imgur.com/ymQQ6nN.png" alt=""></p>
<p>2、日志输出</p>
<p><img src="http://i.imgur.com/o1OxJMa.png" alt=""></p>
<h3 id="使用session-clearCache-强制查询不缓存"><a href="#使用session-clearCache-强制查询不缓存" class="headerlink" title="使用session.clearCache()强制查询不缓存"></a>使用session.clearCache()强制查询不缓存</h3><p>1、代码</p>
<p><img src="http://i.imgur.com/2m1FkUi.png" alt=""></p>
<p>2、日志输出：</p>
<p><img src="http://i.imgur.com/IrbSbCH.png" alt=""></p>
<p>向数据库发送两次查询语句</p>
<h3 id="执行update-delete-insert-语句的时候，会刷新缓存"><a href="#执行update-delete-insert-语句的时候，会刷新缓存" class="headerlink" title="执行update,delete,insert 语句的时候，会刷新缓存"></a>执行update,delete,insert 语句的时候，会刷新缓存</h3><p>1、代码</p>
<p><img src="http://i.imgur.com/TxLA7bj.png" alt=""></p>
<p>2、日志</p>
<p><img src="http://i.imgur.com/CBcMlvg.png" alt=""></p>
<h2 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h2><p>mybatis 的二级缓存的 <strong><em>作用域</em></strong> 是一个mapper的<strong><em>namespace</em></strong> ，同一个namespace中查询sql可以从缓存中命中</p>
<h3 id="开启二级缓存"><a href="#开启二级缓存" class="headerlink" title="开启二级缓存"></a>开启二级缓存</h3><p>需要在mapper.xml 中加入如下：</p>
<pre><code>&lt;cache /&gt;
</code></pre><h3 id="测试二级缓存"><a href="#测试二级缓存" class="headerlink" title="测试二级缓存"></a>测试二级缓存</h3><ul>
<li>查询一次</li>
<li>关闭sqlSession</li>
<li>重新打开sqlSession</li>
<li>继续查询，观察是否发送sql语句</li>
</ul>
<p>1、代码</p>
<p><img src="http://i.imgur.com/Ny0NUin.png" alt=""></p>
<p>2、日志<br>　　<br><img src="http://i.imgur.com/e489uAs.png" alt=""></p>
<h3 id="二级缓存的高级配置"><a href="#二级缓存的高级配置" class="headerlink" title="二级缓存的高级配置"></a>二级缓存的高级配置</h3><p><img src="http://i.imgur.com/K1YSI2j.png" alt=""></p>
<h3 id="关闭二级缓存"><a href="#关闭二级缓存" class="headerlink" title="关闭二级缓存"></a>关闭二级缓存</h3><p>在全局的mybatis-config.xml 中去关闭二级缓存</p>
<p><img src="http://i.imgur.com/RW4Q6F3.png" alt=""></p>
<p><img src="http://i.imgur.com/UcpX9OF.png" alt=""></p>
<p><strong><em>测试</em></strong></p>
<p><img src="http://i.imgur.com/Ny0NUin.png" alt=""></p>
<ul>
<li>日志会有两次sql语句查询</li>
</ul>
<h2 id="高级查询★★★★★★"><a href="#高级查询★★★★★★" class="headerlink" title="高级查询★★★★★★"></a>高级查询★★★★★★</h2><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><p><a href="http://blog.csdn.net/tayanxunhua/article/details/19194607" target="_blank" rel="external">http://blog.csdn.net/tayanxunhua/article/details/19194607</a></p>
<p><img src="http://i.imgur.com/uvS6OXb.png" alt=""></p>
<h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><p>1、用户表<br>2、订单表<br>3、产品表</p>
<p>思路：</p>
<ul>
<li>一个用户可以有多个订单，某个订单只属于一个用户：需在订单表中设置指向用户表的外键</li>
<li>一个订单中有多个产品，一个产品可以属于多个订单，关系是多对多：建立中间表，指向订单表和产品表的外键</li>
</ul>
<h3 id="表之间的关系，以订单表作为出发点"><a href="#表之间的关系，以订单表作为出发点" class="headerlink" title="表之间的关系，以订单表作为出发点"></a>表之间的关系，以订单表作为出发点</h3><p><img src="http://i.imgur.com/rnuPgvZ.png" alt=""></p>
<p>订单表与用户表：1：1</p>
<ul>
<li>一个订单只能属于一个人 1：1</li>
<li>一个用户可以有多个订单 1：N</li>
</ul>
<p>订单表与商品表：N:N</p>
<ul>
<li>一个订单可以有多个商品 1：N</li>
<li>一个商品可以属于多个订单表 1：N</li>
</ul>
<p>订单表与订单详情：1：N</p>
<ul>
<li>一个订单有多个订单详情</li>
<li>一个订单详情只属于一个订单</li>
</ul>
<font color="red"><strong><em>总结，以订单的角度看，他们的关系是：</em></strong></font>

<ul>
<li>订单和人是一对一关系</li>
<li>订单和订单详情是一对多的关系</li>
<li>订单和商品是多对多的关系</li>
</ul>
<h3 id="自动映射配置：autoMapping详解"><a href="#自动映射配置：autoMapping详解" class="headerlink" title="自动映射配置：autoMapping详解"></a>自动映射配置：autoMapping详解</h3><p><a href="http://www.cnblogs.com/TheViper/p/4480765.html" target="_blank" rel="external">http://www.cnblogs.com/TheViper/p/4480765.html</a><br><a href="http://www.zhihu.com/question/41983738/answer/98829976" target="_blank" rel="external">http://www.zhihu.com/question/41983738/answer/98829976</a></p>
<h3 id="一对一查询"><a href="#一对一查询" class="headerlink" title="一对一查询"></a>一对一查询</h3><ul>
<li>查询订单，并且查询出下单人的信息</li>
<li>核心思想：面向对象的思想，在Order对象中添加User对象</li>
<li><strong>association关联元素</strong>处理一对一关联，比如：一个博客只有一个作者，一张订单只属于一个用户</li>
</ul>
<p><strong>方法一：关联的嵌套查询 （select联合查询，懒加载）</strong></p>
<p>Domain</p>
<pre>
public class Order {
    private int id;
    <font color="red">private User user;//private int user_id;</font>
    private String order_number;
}
</pre>

<p>定义OrderMapper接口</p>
<pre><code>public interface OrderMapper {
    public Order queryOrderAndUserLazy(String orderNumber);
}
</code></pre><p>Ordermapper.xml</p>
<pre><code>&lt;!--1、查询订单，属性中包含对象必须使用resultMap--&gt;
&lt;select id=&quot;queryOrderAndUserLazy&quot; resultMap=&quot;lazyOrderUserResultMap&quot;&gt;
    SELECT * FROM tb_order WHERE order_number = #{order_number}
&lt;/select&gt;

&lt;!--2、指定Order中user成员变量的详细装配方式，即根据user_id查询User对象--&gt;
&lt;resultMap id=&quot;lazyOrderUserResultMap&quot; type=&quot;Order&quot;&gt;
    &lt;!-- 一个 ID 结果，标记结果作为 ID 可以帮助提高整体效能 --&gt;
    &lt;id property=&quot;id&quot; column=&quot;id&quot;&gt;&lt;/id&gt;
    &lt;!--resultMap必须制定javaType，如果你映射到一个JavaBean，MyBatis通常可以断定类型--&gt;
    &lt;association property=&quot;user&quot; javaType=&quot;User&quot; column=&quot;user_id&quot; select=&quot;queryUserById&quot;/&gt;
&lt;/resultMap&gt;

&lt;!--3、查询用户--&gt;
&lt;select id=&quot;queryUserById&quot; resultType=&quot;User&quot;&gt;
    SELECT * FROM tb_user where id = #{id}
&lt;/select&gt;
</code></pre><p>测试</p>
<pre><code>@Test
public void testQueryOrderAndUserByOrderNumber() throws Exception {
    Order order = orderMapper.queryOrderAndUserLazy(&quot;20140921001&quot;);
    System.out.println(order);
    System.out.println(order.getUser());
}
</code></pre><p><strong>有两个查询语句</strong>：一个来加载订单，另外一个来加载用户, 而且订单的结果映射描述了”queryUserById”语句应该被用来加载它的 User 属性。  </p>
<p><strong>其他所有的属性将会被自动加载，假设它们的列和属性名相匹配</strong>。这种方式很简单, 但是对于大型数据集合和列表将不会表现很好，就会出现”N+1”的问题。</p>
<p>“N+1”的问题可以是这样引起的：<br>你执行了一个单独的 SQL 语句来获取结果列表(就是”+1”)——查询Order语句<br>对返回的每条记录,你执行了一个查询语句来为每个加载细节(就是”N”)——查询User语句<br>这个问题会导致成百上千的 SQL 语句被执行，这通常不是期望的</p>
<p>MyBatis 能<strong>延迟加载</strong>这样的查询就是一个好处,因此你可以分散这些语句同时运行的消耗。然而,如果你加载一个列表,之后迅速迭代来访问嵌套的数据,你会调用所有的延迟加载,这样的行为可能是很糟糕的。所以还有另外一种方法</p>
<p><strong>方法二：关联查询</strong></p>
<p>方式一：属性全部重命名，手动映射</p>
<ul>
<li>代替了执行一个分离的语句,我们联合订单表和用户表在一起</li>
<li>所有结果被唯一而且清晰的名字来重命名，这使得映射非常简单</li>
<li>缺点是所有字段都要手动映射，操作简单，但工作量较大，可以使用自动映射</li>
</ul>
<pre><code>&lt;!--联合查询订单和用户，一对一关系--&gt;
&lt;select id=&quot;queryOrderAndUserByOrderNumber&quot; resultMap=&quot;orderUserResultMap&quot;&gt;
    SELECT
        o.id as order_id,
        o.user_id as order_user_id,
        o.order_number as order_order_number,
        u.id as user_id,
        u.user_name as user_user_name,
        u.password as user_password,
        u.name as user_name,
        u.age as user_age,
        u.sex as user_sex,
        u.birthday as user_birthday,
        u.created as user_created,
        u.updated as user_updated
    FROM
        tb_order o
    LEFT JOIN tb_user u ON u.id = o.user_id
    WHERE
      o.order_number = #{order_number}
&lt;/select&gt;
&lt;resultMap id=&quot;orderUserResultMap&quot; type=&quot;Order&quot; autoMapping=&quot;true&quot;&gt;
    &lt;id property=&quot;id&quot; column=&quot;order_id&quot;/&gt;
    &lt;result property=&quot;order_number&quot; column=&quot;order_order_number&quot;/&gt;&lt;!-- 有顺序要求，必须放在id后--&gt;
    &lt;association property=&quot;user&quot; javaType=&quot;User&quot;&gt;
        &lt;id property=&quot;id&quot; column=&quot;user_id&quot;/&gt;
        &lt;result property=&quot;user_name&quot; column=&quot;user_name&quot;/&gt;
        &lt;result property=&quot;password&quot; column=&quot;user_password&quot;/&gt;
        &lt;result property=&quot;name&quot; column=&quot;user_name&quot;/&gt;
        &lt;result property=&quot;age&quot; column=&quot;user_age&quot;/&gt;
        &lt;result property=&quot;sex&quot; column=&quot;user_sex&quot;/&gt;
        &lt;result property=&quot;birthday&quot; column=&quot;user_birthday&quot;/&gt;
        &lt;result property=&quot;created&quot; column=&quot;user_created&quot;/&gt;
        &lt;result property=&quot;updated&quot; column=&quot;user_updated&quot;/&gt;
    &lt;/association&gt;
&lt;/resultMap&gt;
</code></pre><p>方式二：自动映射，冲突字段自动命名，手动映射，其余元素自动匹配（推荐）★★★★★</p>
<ul>
<li>当自动匹配结果的时候，Mybatis会获取列名，并且查找一个相同的属性（忽略大小写）。这意味着命名为ID的列和命名为id的属性被查找到的时候，Mybatis将会把列ID的值赋给属性id</li>
<li>通常数据库列名命名的时候使用大写和下划线并且Java属性常常依据驼峰命名法。为了保证在他们之间的自动匹配要设置属性 mapUnderscoreToCamelCase 为 true</li>
<li>对于每一个result map，所有的在ResultSet中有的并且<strong>没有被手动匹配的列将会被自动的匹配</strong>。默认不开启，<strong>设置 autoMapping=”true”开启</strong></li>
<li><font color="red"><strong><em>冲突字段重命名，自动赋值，其余元素自动匹配</em></strong></font>


</li>
</ul>
<pre><code>&lt;!--联合查询订单和用户，一对一关系--&gt;
&lt;select id=&quot;queryOrderAndUserByOrderNumber&quot; resultMap=&quot;orderUserResultMap&quot;&gt;
    SELECT
      *,u.id as user_id,o.id as order_id
    FROM
      tb_order o
    LEFT JOIN tb_user u ON u.id = o.user_id
    WHERE
      o.order_number = #{order_number}
&lt;/select&gt;
&lt;resultMap id=&quot;orderUserResultMap&quot; type=&quot;Order&quot; autoMapping=&quot;true&quot;&gt;
    &lt;id property=&quot;id&quot; column=&quot;order_id&quot;/&gt;
    &lt;association property=&quot;user&quot; javaType=&quot;User&quot; autoMapping=&quot;true&quot;&gt;
        &lt;id property=&quot;id&quot; column=&quot;user_id&quot;/&gt;
    &lt;/association&gt;
&lt;/resultMap&gt;
</code></pre><p>方式三：外部结果映射</p>
<p>使用外部的结果映射元素来映射关联，使得User结果映射可以重用。如果你不需要重用它的话，或者你仅仅引用你所有的结果映射合到一个单独描述的结果映射中，即方式二</p>
<pre><code>&lt;!--联合查询订单和用户，一对一关系--&gt;
&lt;select id=&quot;queryOrderAndUserByOrderNumber&quot; resultMap=&quot;orderUserResultMap&quot;&gt;
    SELECT
    *,u.id as user_id,o.id as order_id
    FROM
    tb_order o
    LEFT JOIN tb_user u ON u.id = o.user_id
    WHERE
    o.order_number = #{order_number}
&lt;/select&gt;

&lt;resultMap id=&quot;orderUserResultMap&quot; type=&quot;Order&quot; autoMapping=&quot;true&quot;&gt;
    &lt;id property=&quot;id&quot; column=&quot;order_id&quot;/&gt;
    &lt;association property=&quot;user&quot; javaType=&quot;User&quot; resultMap=&quot;user&quot;/&gt;
&lt;/resultMap&gt;

&lt;resultMap id=&quot;user&quot; type=&quot;User&quot; autoMapping=&quot;true&quot;&gt;
    &lt;id property=&quot;id&quot; column=&quot;user_id&quot;/&gt;
&lt;/resultMap&gt;
</code></pre><h3 id="一对多查询"><a href="#一对多查询" class="headerlink" title="一对多查询"></a>一对多查询</h3><p>查询订单，查询出下单人信息并且查询出订单详情</p>
<ul>
<li>订单表、用户表、订单详情三表联合查询</li>
<li>映射结果为Order类，填充user和orderDetails属性对象</li>
</ul>
<p>Domain</p>
<pre><code>public class Order {
    private int id;
    private User user;//private int user_id;
    private String order_number;
    private List&lt;OrderDetail&gt; orderDetails;
}
</code></pre><p>定义OrderMapper接口</p>
<pre><code>public interface OrderMapper {
    public Order queryOrderAndUserAndDetailByOrderNumber(String orderNumber);
}
</code></pre><p>OrderMapper.xml</p>
<pre><code>&lt;!--collection：1：N--&gt;
&lt;select id=&quot;queryOrderAndUserAndDetailByOrderNumber&quot; resultMap=&quot;orderUserDetailResultMap&quot;&gt;
    SELECT
        *,o.id as order_id,d.id as detail_id
    FROM
        tb_order o
    LEFT JOIN tb_user u ON u.id = o.user_id
    LEFT JOIN tb_orderdetail d ON o.id = d.order_id
    WHERE o.order_number = #{order_number}
&lt;/select&gt;
&lt;resultMap id=&quot;orderUserDetailResultMap&quot; type=&quot;Order&quot; autoMapping=&quot;true&quot;&gt;
    &lt;id property=&quot;id&quot; column=&quot;order_id&quot;/&gt;
    &lt;association property=&quot;user&quot; javaType=&quot;User&quot; autoMapping=&quot;true&quot;&gt;
        &lt;id property=&quot;id&quot; column=&quot;user_id&quot;/&gt;
    &lt;/association&gt;
    &lt;!--collection 定义集合
        property：集合的属性名
        javaType：集合的类型
        ofType：集合中成员类型
        子标签内：填id和result
    --&gt;
    &lt;collection property=&quot;orderDetails&quot; javaType=&quot;List&quot; ofType=&quot;OrderDetail&quot; autoMapping=&quot;true&quot;&gt;
        &lt;id property=&quot;id&quot; column=&quot;detail_id&quot;/&gt;
    &lt;/collection&gt;
&lt;/resultMap&gt;
</code></pre><p>测试</p>
<pre><code>Order order = orderMapper.queryOrderAndUserAndDetailByOrderNumber(&quot;20140921001&quot;);
System.out.println(order);
List&lt;OrderDetail&gt; orderDetails = order.getOrderDetails();
for(OrderDetail d : orderDetails)
    System.out.println(d);
</code></pre><h3 id="多对多查询"><a href="#多对多查询" class="headerlink" title="多对多查询"></a>多对多查询</h3><p>查询订单，查询出下单人信息并且查询出订单详情中的商品数据</p>
<p>doamin</p>
<pre><code>public class OrderDetail {
    private int id;
    private Order order;//private int order_id;
    private Item item;//private int item_id;
    private double total_price;
    private int status;
}
</code></pre><p>定义OrderMapper</p>
<pre><code>public interface OrderMapper {
    public Order queryOrdreAndUserAndDetailAndItemByOrderNumber(String orderNumber);
}
</code></pre><p>OrderMapper.xml</p>
<pre><code>&lt;!--查询订单，查询出下单人信息并且查询出订单详情中的商品数据 N:N--&gt;
&lt;select id=&quot;queryOrdreAndUserAndDetailAndItemByOrderNumber&quot; resultMap=&quot;orderUserDetailItemResultMap&quot;&gt;
    SELECT
        *
    FROM
        tb_order o
    LEFT JOIN tb_user u ON u.id = o.user_id
    LEFT JOIN tb_orderdetail d ON o.id = d.order_id
    LEFT JOIN tb_item i ON d.item_id = i.id
    WHERE o.order_number = #{order_number}
&lt;/select&gt;
&lt;resultMap id=&quot;orderUserDetailItemResultMap&quot; type=&quot;Order&quot; autoMapping=&quot;true&quot;&gt;
    &lt;id property=&quot;id&quot; column=&quot;order_id&quot;/&gt;
    &lt;association property=&quot;user&quot; javaType=&quot;User&quot; autoMapping=&quot;true&quot;&gt;
        &lt;id property=&quot;id&quot; column=&quot;user_id&quot;/&gt;
    &lt;/association&gt;
    &lt;collection property=&quot;orderDetails&quot; javaType=&quot;List&quot; ofType=&quot;OrderDetail&quot; autoMapping=&quot;true&quot;&gt;
        &lt;id property=&quot;id&quot; column=&quot;detail_id&quot;/&gt;
        &lt;association property=&quot;item&quot; javaType=&quot;Item&quot; autoMapping=&quot;true&quot;&gt;
            &lt;id property=&quot;id&quot; column=&quot;item_id&quot;&gt;&lt;/id&gt;
        &lt;/association&gt;
    &lt;/collection&gt;
&lt;/resultMap&gt;
</code></pre><p>测试</p>
<pre><code>@Test
public void testQueryOrdreAndUserAndDetailAndItemByOrderNumber(){
    Order order = orderMapper.queryOrdreAndUserAndDetailAndItemByOrderNumber(&quot;20140921001&quot;);
    System.out.println(order);
}
</code></pre><h3 id="resultMap的继承"><a href="#resultMap的继承" class="headerlink" title="resultMap的继承"></a>resultMap的继承</h3><p><img src="http://i.imgur.com/R9JdYy3.png" alt=""></p>
<h2 id="延迟加载-未成功"><a href="#延迟加载-未成功" class="headerlink" title="延迟加载(未成功)"></a>延迟加载(未成功)</h2><h3 id="开启延迟加载"><a href="#开启延迟加载" class="headerlink" title="开启延迟加载"></a>开启延迟加载</h3><pre><code>&lt;settings&gt;
    &lt;!-- 打开延迟加载的开关 --&gt;
    &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;
    &lt;!-- 将积极加载改为消极加载，即延迟加载 --&gt;
    &lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;
&lt;/settings&gt;
</code></pre><ul>
<li>lazyLoadingEnabled：true使用延迟加载，false禁用延迟加载，默认为false</li>
<li>aggressiveLazyLoading：<ul>
<li>默认true，当有一个进行加载的时候，就会把所有没有加载的属性加载进来</li>
<li>false按需加载，只有调用对应的getter的才会去加载</li>
</ul>
</li>
</ul>
<h3 id="添加cglib"><a href="#添加cglib" class="headerlink" title="添加cglib"></a>添加cglib</h3><pre><code>&lt;dependency&gt;
        &lt;groupId&gt;cglib&lt;/groupId&gt;
        &lt;artifactId&gt;cglib&lt;/artifactId&gt;
        &lt;version&gt;3.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h3 id="接口定义"><a href="#接口定义" class="headerlink" title="接口定义"></a>接口定义</h3><pre><code>public interface OrderMapper {
    public Order queryOrderAndUserLazy(String orderNumber);
}
</code></pre><h3 id="OrderMapper-xml"><a href="#OrderMapper-xml" class="headerlink" title="OrderMapper.xml"></a>OrderMapper.xml</h3><pre>
&lt;mapper namespace="cn.apeius.mybatis.mapper.OrderMapper">
    &lt;select id="queryOrderAndUserLazy" resultMap="<font color=" red">lazyOrderUserResultMap</font>">
        SELECT * FROM tb_order WHERE order_number = #{order_number}
    &lt;/select>
    &lt;resultMap id="<font color="red">lazyOrderUserResultMap</font>" type="Order" autoMapping="true">
        &lt;id property="id" column="id">&lt;/id>
            &lt;-- columnw中的user_id作为参数传入queryUserById-->
        &lt;association property="user" javaType="User" column="user_id" select="<font color="blue">queryUserById</font>"/>
    &lt;/resultMap>
    &lt;select id="<font color="blue">queryUserById</font>" resultType="User">
        SELECT * FROM tb_user where id = #{id}
    &lt;/select>
&lt;/mapper>
</pre>

<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><pre><code>@Test
public void testQueryOrderAndUserLazy(){
    OrderMapper orderMapper = sqlSession.getMapper(OrderMapper.class);
    Order order = orderMapper.queryOrderAndUserLazy(&quot;20140921001&quot;);
    System.out.println(order.getOrder_number());
    System.out.println(order.getUser());
}
</code></pre><h2 id="分页插件"><a href="#分页插件" class="headerlink" title="分页插件"></a>分页插件</h2><ul>
<li>Mybatis提供了plugin机制，<strong><em>允许我们在mybatis的原有流程上加入自己的逻辑</em></strong>，加上分页逻辑可以方便实现分页</li>
<li>原理是利用了拦截器，mybatis支持的拦截接口有四个：Executor、ParameterHandler、ResultSetHandlet、StatementHandler</li>
</ul>
<h3 id="plugin实现原理"><a href="#plugin实现原理" class="headerlink" title="plugin实现原理"></a>plugin实现原理</h3><p><img src="http://i.imgur.com/qP9KCdP.png" alt=""></p>
<p>原来的sql语句:</p>
<pre><code>select * from tb_user
</code></pre><p>经过拦截器后，变为:</p>
<pre><code>selectd * from tb_user limit 1,10
</code></pre><p>从而实现分页</p>
<h3 id="使用PageHelper实现分页"><a href="#使用PageHelper实现分页" class="headerlink" title="使用PageHelper实现分页"></a>使用PageHelper实现分页</h3><p>PageHelper实现了通用的分页查询，其支持的数据库有Mysq、Oracle、DB2、PostgreSQL等主流数据库</p>
<h3 id="导入依赖-1"><a href="#导入依赖-1" class="headerlink" title="导入依赖"></a>导入依赖</h3><pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;
    &lt;artifactId&gt;pagehelper&lt;/artifactId&gt;
    &lt;version&gt;3.7.5&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.github.jsqlparser&lt;/groupId&gt;
    &lt;artifactId&gt;jsqlparser&lt;/artifactId&gt;
    &lt;version&gt;0.9.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h3 id="配置插件"><a href="#配置插件" class="headerlink" title="配置插件"></a>配置插件</h3><pre><code>&lt;plugins&gt;
    &lt;plugin interceptor=&quot;com.github.pagehelper.PageHelper&quot;&gt;
        &lt;!--数据库方言--&gt;
        &lt;property name=&quot;dialect&quot; value=&quot;mysql&quot;/&gt;
        &lt;!--设置为true时，使用RowBounds分页会进行count查询，即会去查询出总数--&gt;
        &lt;property name=&quot;rowBoundsWithCount&quot; value=&quot;true&quot;/&gt;
    &lt;/plugin&gt;
&lt;/plugins&gt;
</code></pre><h3 id="在执行查询时设置分页参数"><a href="#在执行查询时设置分页参数" class="headerlink" title="在执行查询时设置分页参数"></a>在执行查询时设置分页参数</h3><pre><code>@Test
public void testPage(){
    //开启分页，第一个参数：当前的页数；第二个参数：每页几条数据
    PageHelper.startPage(2,5);
    //紧接着的第一个查询会被执行分页
    List&lt;User&gt; users = userMapper.queryAllUser();
    for(User u : users){
        System.out.println(u);
    }

    //获取分页信息
    PageInfo&lt;User&gt; pageInfo = new PageInfo&lt;User&gt;(users);
    pageInfo.getList();//与users为同一个引用
    System.out.println(&quot;总记录数：&quot; + pageInfo.getTotal());
    System.out.println(&quot;总页数 &quot; + pageInfo.getPages());
    System.out.println(&quot;当前页数 &quot; + pageInfo.getPageNum());
    System.out.println(&quot;每页多少数据 &quot; + pageInfo.getPageSize());
    System.out.println(&quot;当前页的数据条目数 &quot; + pageInfo.getSize());
}
</code></pre><h2 id="mybatis和spring整合"><a href="#mybatis和spring整合" class="headerlink" title="mybatis和spring整合"></a>mybatis和spring整合</h2><h3 id="官方文档-1"><a href="#官方文档-1" class="headerlink" title="官方文档"></a>官方文档</h3><p><a href="https://github.com/rhapsody1290/MybatisStudy/tree/master/doc/%E4%B8%AD%E6%96%87%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3/Mybatis-Spring-1.2.2" target="_blank" rel="external">https://github.com/rhapsody1290/MybatisStudy/tree/master/doc/%E4%B8%AD%E6%96%87%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3/Mybatis-Spring-1.2.2</a></p>
<h3 id="什么是MyBatis-Spring"><a href="#什么是MyBatis-Spring" class="headerlink" title="什么是MyBatis-Spring"></a>什么是MyBatis-Spring</h3><ul>
<li>MyBatis-Spring 会帮助你将 MyBatis 代码 <strong><em>无缝地整合</em></strong> 到 Spring 中，使用这个类库中的类, Spring 将会<strong><em>加载必要的 MyBatis 工厂类和 session 类</em></strong></li>
<li>这个类库也提供一个简单的方式来注入 MyBatis 数据映射器和 SqlSession 到业务层的 bean 中</li>
<li>它也会处理事务, 翻译 MyBatis 的异常到 Spring 的 DataAccessException 异常中</li>
<li>最终,它并不会依赖于 MyBatis,Spring 或 MyBatis-Spring 来构建应用程序代码</li>
</ul>
<h3 id="导入依赖-2"><a href="#导入依赖-2" class="headerlink" title="导入依赖"></a>导入依赖</h3><p>mybatis-spring整合包</p>
<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
  &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;
  &lt;version&gt;1.2.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>c3p0依赖，一个开源的JDBC连接池</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;c3p0&lt;/groupId&gt;
    &lt;artifactId&gt;c3p0&lt;/artifactId&gt;
    &lt;version&gt;0.9.1.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h3 id="c3p0-properties-数据源"><a href="#c3p0-properties-数据源" class="headerlink" title="c3p0.properties(数据源)"></a>c3p0.properties(数据源)</h3><pre><code>c3p0.driverClass=com.mysql.jdbc.Driver
c3p0.url=jdbc:mysql://localhost:3306/mybatis
c3p0.user=root
c3p0.password=root
</code></pre><h3 id="配置spring的配置文件applicationContext-xml"><a href="#配置spring的配置文件applicationContext-xml" class="headerlink" title="配置spring的配置文件applicationContext.xml"></a>配置spring的配置文件applicationContext.xml</h3><ul>
<li>引入配置文件c3p0.properties</li>
<li>配置连接池</li>
<li>配置sqlSessionFactory<ul>
<li>引入数据源</li>
<li>引入mybatis的全局配置</li>
<li>包扫描方式配置别名typeAliasesPackage</li>
<li>mapper.xml所在路径(Mapper.xml和java代码分离)</li>
</ul>
</li>
<li>mapper接口所在的包</li>
</ul>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;

    &lt;!-- 引入配置文件 --&gt;
    &lt;bean class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;
        &lt;property name=&quot;locations&quot;&gt;
            &lt;list&gt;
                &lt;value&gt;classpath:c3p0.properties&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- 配置连接池 --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;${c3p0.driverClass}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;${c3p0.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;${c3p0.user}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${c3p0.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置sqlSessionFactory。SqlSessionFactoryBean 是用于创建 SqlSessionFactory 的--&gt;
    &lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
        &lt;!--引入数据源--&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
        &lt;!--引入mybatis的全局配置--&gt;
        &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot;/&gt;
        &lt;!--mybatis别名包--&gt;
        &lt;property name=&quot;typeAliasesPackage&quot; value=&quot;cn.apeius.mybatis.domain&quot;/&gt;
        &lt;!--mapper.xml所在路径,可以使mapper接口与mapper.xml分离；可以使用通配符，**表示所有目录--&gt;
        &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath*:mapper/**/*.xml&quot; /&gt;
    &lt;/bean&gt;

    &lt;!--指定扫描包，mapper接口所在的包--&gt;
    &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
        &lt;!--多个扫描包可以通过逗号或分号进行分割--&gt;
        &lt;property name=&quot;basePackage&quot; value=&quot;cn.apeius.mybatis.mapper&quot; /&gt;
    &lt;/bean&gt;

&lt;/beans&gt;
</code></pre><h3 id="mybatis-config-xml"><a href="#mybatis-config-xml" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h3><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
    &lt;settings&gt;
        &lt;!-- 打开延迟加载的开关 --&gt;
        &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;
        &lt;!-- 将积极加载改为消极加载，即延迟加载 --&gt;
        &lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;
    &lt;/settings&gt;
    &lt;plugins&gt;
        &lt;plugin interceptor=&quot;com.github.pagehelper.PageHelper&quot;&gt;
            &lt;!--数据库方言--&gt;
            &lt;property name=&quot;dialect&quot; value=&quot;mysql&quot;/&gt;
            &lt;!--设置为true时，使用RowBounds分页会进行count查询，即会去查询出总数--&gt;
            &lt;property name=&quot;rowBoundsWithCount&quot; value=&quot;true&quot;/&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/configuration&gt;
</code></pre><p><strong><em>问题：为什么配置SqlSessionFactory时，class为SqlSessionFactory</em></strong></p>
<ul>
<li>在基本的 MyBatis 中, SqlSessionFactory 可以使用 SqlSessionFactoryBuilder 来创建，而在 MyBatis-Spring 中,则使用 SqlSessionFactoryBean 来替代</li>
<li>SqlSessionFactoryBean 实现了 Spring 的 FactoryBean 接口，这就说明了由 Spring 最终创建的 bean <strong><em>不是 SqlSessionFactoryBean 本身</em></strong> ,  而是工厂类的 getObject()返回的方法的结果。这种情况下,Spring 将会在应用启动时为你 创建 SqlSessionFactory 对象,然后将它以 SqlSessionFactory 为名来存储</li>
</ul>
<h3 id="mybatis和spring整合测试"><a href="#mybatis和spring整合测试" class="headerlink" title="mybatis和spring整合测试"></a>mybatis和spring整合测试</h3><pre><code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);
UserMapper userMapper = context.getBean(UserMapper.class);
List&lt;User&gt; users = userMapper.queryAllUser();
for(User user : users){
    System.out.println(user.getId() + &quot; &quot; + user.getUser_name());
}
</code></pre><h2 id="mapper整合servcie"><a href="#mapper整合servcie" class="headerlink" title="mapper整合servcie"></a>mapper整合servcie</h2><h3 id="servcie接口"><a href="#servcie接口" class="headerlink" title="servcie接口"></a>servcie接口</h3><pre><code>public interface UserServiceInter {

    public List&lt;User&gt; queryAll();
}
</code></pre><h3 id="service实现"><a href="#service实现" class="headerlink" title="service实现"></a>service实现</h3><pre><code>@Service
public class UserServiceImp implements UserServiceInter {

    @Autowired
    private UserMapper userMapper;

    @Override
    public List&lt;User&gt; queryAll() {
        return userMapper.queryAllUser();
    }
}
</code></pre><h3 id="applicationContext-xml配置"><a href="#applicationContext-xml配置" class="headerlink" title="applicationContext.xml配置"></a>applicationContext.xml配置</h3><p>使service属性自动注入</p>
<pre><code>&lt;context:component-scan base-package=&quot;cn.apeius.mybatis.service.imp&quot;&gt;&lt;/context:component-scan&gt;
</code></pre><h3 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h3><pre><code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);
UserServiceInter userServiceInter = context.getBean(UserServiceImp.class);
List&lt;User&gt; users = userServiceInter.queryAll();
for(User user : users){
    System.out.println(user);
}
</code></pre><h2 id="mybatis整合事务管理（未成功）"><a href="#mybatis整合事务管理（未成功）" class="headerlink" title="mybatis整合事务管理（未成功）"></a>mybatis整合事务管理（未成功）</h2><h3 id="配置事务管理"><a href="#配置事务管理" class="headerlink" title="配置事务管理"></a>配置事务管理</h3><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd
    http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;&gt;

    &lt;!-- 定义事务管理器 --&gt;
    &lt;bean id=&quot;transactionManager&quot;
          class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
    &lt;/bean&gt;

    &lt;!-- 定义事务策略 --&gt;
    &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;
        &lt;tx:attributes&gt;
            &lt;!--所有以query开头的方法都是只读的 --&gt;
            &lt;tx:method name=&quot;query*&quot; read-only=&quot;true&quot; /&gt;
            &lt;!--其他方法使用默认事务策略 --&gt;
            &lt;tx:method name=&quot;*&quot; /&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;

    &lt;aop:config&gt;
        &lt;!--pointcut元素定义一个切入点，execution中的第一个星号 用以匹配方法的返回类型，
            这里星号表明匹配所有返回类型。 com.abc.dao.*.*(..)表明匹配cn.itcast.mybatis.service包下的所有类的所有方法 --&gt;
        &lt;aop:pointcut id=&quot;myPointcut&quot; expression=&quot;execution(* cn.apeius.mybatis.service.*.*(..))&quot; /&gt;
        &lt;!--将定义好的事务处理策略应用到上述的切入点 --&gt;
        &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;myPointcut&quot; /&gt;
    &lt;/aop:config&gt;

&lt;/beans&gt;
</code></pre><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><pre><code>@Service
public class UserServiceImp implements UserServiceInter {

    @Autowired
    protected UserMapper userMapper;

    @Override
    public List&lt;User&gt; queryAll() {
        return userMapper.queryAllUser();
    }

    @Override
    public void saveUser(User user) {
        userMapper.addUser(user);
        //int a = 9 / 0;
    }
}
</code></pre><h3 id="测试-3"><a href="#测试-3" class="headerlink" title="测试"></a>测试</h3><pre><code>@Before
public void setUp(){
    ApplicationContext context = new ClassPathXmlApplicationContext(new String[]{&quot;applicationContext.xml&quot;,&quot;applicationContext-transaction.xml&quot;});
    userServiceInter = context.getBean(UserServiceImp.class);
}

@Test
public void testSaveUser(){
    User user = new User();
    user.setUser_name(&quot;陈冠希&quot;);
    user.setName(&quot;dsfa&quot;);
    userServiceInter.saveUser(user);
}
</code></pre>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaEE/" rel="tag"># JavaEE</a>
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/mybatis/" rel="tag"># mybatis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/08/09/[Java]命令行编译Java程序/" rel="next" title="命令行编译Java程序">
                <i class="fa fa-chevron-left"></i> 命令行编译Java程序
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/08/11/[Struts2]Struts2笔记/" rel="prev" title="Struts2笔记">
                Struts2笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Mr.Qian" />
          <p class="site-author-name" itemprop="name">Mr.Qian</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">145</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">87</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC回顾"><span class="nav-number">1.</span> <span class="nav-text">JDBC回顾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JDBC连接数据库分为六步"><span class="nav-number">1.1.</span> <span class="nav-text">JDBC连接数据库分为六步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#存在的问题及解决方案"><span class="nav-number">1.2.</span> <span class="nav-text">存在的问题及解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis介绍★★"><span class="nav-number">2.</span> <span class="nav-text">mybatis介绍★★</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis整体架构"><span class="nav-number">3.</span> <span class="nav-text">mybatis整体架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis快速入门-参考官方文档-★★★★★"><span class="nav-number">4.</span> <span class="nav-text">mybatis快速入门(参考官方文档)★★★★★</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#github"><span class="nav-number">4.1.</span> <span class="nav-text">github</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">4.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从-XML-中构建-SqlSessionFactory"><span class="nav-number">4.3.</span> <span class="nav-text">从 XML 中构建 SqlSessionFactory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mapper-xml——映射文件"><span class="nav-number">4.4.</span> <span class="nav-text">mapper.xml——映射文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从-SqlSessionFactory-中获取-SqlSession"><span class="nav-number">4.5.</span> <span class="nav-text">从 SqlSessionFactory 中获取 SqlSession</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可能的错误"><span class="nav-number">4.6.</span> <span class="nav-text">可能的错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mybatis使用步骤总结"><span class="nav-number">4.7.</span> <span class="nav-text">mybatis使用步骤总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加日志支持"><span class="nav-number">5.</span> <span class="nav-text">添加日志支持</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#导入依赖"><span class="nav-number">5.1.</span> <span class="nav-text">导入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写配置文件"><span class="nav-number">5.2.</span> <span class="nav-text">编写配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#完整的CRUD操作-未使用动态代理类-★★★★★"><span class="nav-number">6.</span> <span class="nav-text">完整的CRUD操作(未使用动态代理类)★★★★★</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建UserDao接口"><span class="nav-number">6.1.</span> <span class="nav-text">创建UserDao接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建UserDao的实现类"><span class="nav-number">6.2.</span> <span class="nav-text">创建UserDao的实现类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写User对应的Mapper-xml"><span class="nav-number">6.3.</span> <span class="nav-text">编写User对应的Mapper.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全部配置文件mybatis-config-xml加入UserMapper-xml"><span class="nav-number">6.4.</span> <span class="nav-text">全部配置文件mybatis-config.xml加入UserMapper.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写测试用例JUNIT★★★★★★★"><span class="nav-number">6.5.</span> <span class="nav-text">编写测试用例JUNIT★★★★★★★</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决数据库字段名和实体类属性名不一致的问题"><span class="nav-number">6.6.</span> <span class="nav-text">解决数据库字段名和实体类属性名不一致的问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态代理mapper实现类★★★★★★★"><span class="nav-number">7.</span> <span class="nav-text">动态代理mapper实现类★★★★★★★</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#思考CURD的dao中的问题"><span class="nav-number">7.1.</span> <span class="nav-text">思考CURD的dao中的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#名称空间"><span class="nav-number">7.2.</span> <span class="nav-text">名称空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过sqlSession-getMapper-Class"><span class="nav-number">7.3.</span> <span class="nav-text">通过sqlSession.getMapper(Class)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用步骤"><span class="nav-number">7.4.</span> <span class="nav-text">使用步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#定义接口"><span class="nav-number">7.4.1.</span> <span class="nav-text">定义接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编写mapper-xml文件"><span class="nav-number">7.4.2.</span> <span class="nav-text">编写mapper.xml文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#调用"><span class="nav-number">7.4.3.</span> <span class="nav-text">调用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用动态代理总结★★★★★★★★★"><span class="nav-number">7.5.</span> <span class="nav-text">使用动态代理总结★★★★★★★★★</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis-config-xml-配置"><span class="nav-number">8.</span> <span class="nav-text">mybatis-config.xml 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#properties-读取外部的资源文件"><span class="nav-number">8.1.</span> <span class="nav-text">properties(读取外部的资源文件)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#settings（设置）"><span class="nav-number">8.2.</span> <span class="nav-text">settings（设置）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#typeAliases"><span class="nav-number">8.3.</span> <span class="nav-text">typeAliases</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#plugins（插件，又名拦截器）"><span class="nav-number">8.4.</span> <span class="nav-text">plugins（插件，又名拦截器）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#environments（环境）"><span class="nav-number">8.5.</span> <span class="nav-text">environments（环境）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#为什么要适应多种环境"><span class="nav-number">8.5.1.</span> <span class="nav-text">为什么要适应多种环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#指定创建哪种环境"><span class="nav-number">8.5.2.</span> <span class="nav-text">指定创建哪种环境</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mappers映射器"><span class="nav-number">8.6.</span> <span class="nav-text">mappers映射器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#相对于类路径的资源引用"><span class="nav-number">8.6.1.</span> <span class="nav-text">相对于类路径的资源引用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用mapper接口路径"><span class="nav-number">8.6.2.</span> <span class="nav-text">使用mapper接口路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用mapper接口扫描包-常用"><span class="nav-number">8.6.3.</span> <span class="nav-text">使用mapper接口扫描包(常用)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mapper-xml"><span class="nav-number">9.</span> <span class="nav-text">Mapper.xml</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CURD操作"><span class="nav-number">9.1.</span> <span class="nav-text">CURD操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#select——书写select语句"><span class="nav-number">9.1.1.</span> <span class="nav-text">select——书写select语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#insert——书写insert语句"><span class="nav-number">9.1.2.</span> <span class="nav-text">insert——书写insert语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取自增的id的值"><span class="nav-number">9.1.3.</span> <span class="nav-text">获取自增的id的值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#update"><span class="nav-number">9.1.4.</span> <span class="nav-text">update</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete"><span class="nav-number">9.1.5.</span> <span class="nav-text">delete</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#的用法及传入多个参数"><span class="nav-number">9.2.</span> <span class="nav-text">#{}的用法及传入多个参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#的用法及传入多个参数-1"><span class="nav-number">9.3.</span> <span class="nav-text">${}的用法及传入多个参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#面试题：-与-的区别"><span class="nav-number">9.4.</span> <span class="nav-text">面试题：#{}与${}的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resultMap与resultType用法★★★★★★★★"><span class="nav-number">9.5.</span> <span class="nav-text">resultMap与resultType用法★★★★★★★★</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#从SQL查询结果到领域模型实体"><span class="nav-number">9.5.1.</span> <span class="nav-text">从SQL查询结果到领域模型实体　</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resultType"><span class="nav-number">9.5.2.</span> <span class="nav-text">resultType</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resultMap"><span class="nav-number">9.5.3.</span> <span class="nav-text">resultMap</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis学习路线总结★★★★★★★★★★"><span class="nav-number">10.</span> <span class="nav-text">Mybatis学习路线总结★★★★★★★★★★</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一级缓存"><span class="nav-number">11.</span> <span class="nav-text">一级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#测试"><span class="nav-number">11.1.</span> <span class="nav-text">测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用session-clearCache-强制查询不缓存"><span class="nav-number">11.2.</span> <span class="nav-text">使用session.clearCache()强制查询不缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行update-delete-insert-语句的时候，会刷新缓存"><span class="nav-number">11.3.</span> <span class="nav-text">执行update,delete,insert 语句的时候，会刷新缓存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二级缓存"><span class="nav-number">12.</span> <span class="nav-text">二级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#开启二级缓存"><span class="nav-number">12.1.</span> <span class="nav-text">开启二级缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试二级缓存"><span class="nav-number">12.2.</span> <span class="nav-text">测试二级缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二级缓存的高级配置"><span class="nav-number">12.3.</span> <span class="nav-text">二级缓存的高级配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关闭二级缓存"><span class="nav-number">12.4.</span> <span class="nav-text">关闭二级缓存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级查询★★★★★★"><span class="nav-number">13.</span> <span class="nav-text">高级查询★★★★★★</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#官方文档"><span class="nav-number">13.1.</span> <span class="nav-text">官方文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库设计"><span class="nav-number">13.2.</span> <span class="nav-text">数据库设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表之间的关系，以订单表作为出发点"><span class="nav-number">13.3.</span> <span class="nav-text">表之间的关系，以订单表作为出发点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自动映射配置：autoMapping详解"><span class="nav-number">13.4.</span> <span class="nav-text">自动映射配置：autoMapping详解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一对一查询"><span class="nav-number">13.5.</span> <span class="nav-text">一对一查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一对多查询"><span class="nav-number">13.6.</span> <span class="nav-text">一对多查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多对多查询"><span class="nav-number">13.7.</span> <span class="nav-text">多对多查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resultMap的继承"><span class="nav-number">13.8.</span> <span class="nav-text">resultMap的继承</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#延迟加载-未成功"><span class="nav-number">14.</span> <span class="nav-text">延迟加载(未成功)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#开启延迟加载"><span class="nav-number">14.1.</span> <span class="nav-text">开启延迟加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加cglib"><span class="nav-number">14.2.</span> <span class="nav-text">添加cglib</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接口定义"><span class="nav-number">14.3.</span> <span class="nav-text">接口定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OrderMapper-xml"><span class="nav-number">14.4.</span> <span class="nav-text">OrderMapper.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试-1"><span class="nav-number">14.5.</span> <span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分页插件"><span class="nav-number">15.</span> <span class="nav-text">分页插件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#plugin实现原理"><span class="nav-number">15.1.</span> <span class="nav-text">plugin实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用PageHelper实现分页"><span class="nav-number">15.2.</span> <span class="nav-text">使用PageHelper实现分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导入依赖-1"><span class="nav-number">15.3.</span> <span class="nav-text">导入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置插件"><span class="nav-number">15.4.</span> <span class="nav-text">配置插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在执行查询时设置分页参数"><span class="nav-number">15.5.</span> <span class="nav-text">在执行查询时设置分页参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis和spring整合"><span class="nav-number">16.</span> <span class="nav-text">mybatis和spring整合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#官方文档-1"><span class="nav-number">16.1.</span> <span class="nav-text">官方文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是MyBatis-Spring"><span class="nav-number">16.2.</span> <span class="nav-text">什么是MyBatis-Spring</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导入依赖-2"><span class="nav-number">16.3.</span> <span class="nav-text">导入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c3p0-properties-数据源"><span class="nav-number">16.4.</span> <span class="nav-text">c3p0.properties(数据源)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置spring的配置文件applicationContext-xml"><span class="nav-number">16.5.</span> <span class="nav-text">配置spring的配置文件applicationContext.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mybatis-config-xml"><span class="nav-number">16.6.</span> <span class="nav-text">mybatis-config.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mybatis和spring整合测试"><span class="nav-number">16.7.</span> <span class="nav-text">mybatis和spring整合测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mapper整合servcie"><span class="nav-number">17.</span> <span class="nav-text">mapper整合servcie</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#servcie接口"><span class="nav-number">17.1.</span> <span class="nav-text">servcie接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#service实现"><span class="nav-number">17.2.</span> <span class="nav-text">service实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#applicationContext-xml配置"><span class="nav-number">17.3.</span> <span class="nav-text">applicationContext.xml配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试-2"><span class="nav-number">17.4.</span> <span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis整合事务管理（未成功）"><span class="nav-number">18.</span> <span class="nav-text">mybatis整合事务管理（未成功）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置事务管理"><span class="nav-number">18.1.</span> <span class="nav-text">配置事务管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#service"><span class="nav-number">18.2.</span> <span class="nav-text">service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试-3"><span class="nav-number">18.3.</span> <span class="nav-text">测试</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.Qian</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.1"></script>



  

  

  

  

  

  

</body>
</html>
